<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tone.js Sine Wave</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tone/14.7.77/Tone.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px;
            background-color: #f0f0f0;
        }
        .controls {
            display: flex;
            flex-direction: column;
            gap: 20px;
            margin: 20px 0;
            width: 300px;
        }
        button {
            padding: 10px 20px;
            font-size: 16px;
            cursor: pointer;
            background-color: #4CAF50;
            color: white;
            border: none;
            border-radius: 4px;
        }
        button:hover {
            background-color: #45a049;
        }
        .slider-container {
            margin: 10px 0;
        }
        label {
            display: block;
            margin-bottom: 5px;
        }
        canvas {
            background-color: white;
            border: 1px solid #ccc;
            margin: 20px 0;
        }
    </style>
</head>
<body>
    <h1>Sine Wave Generator</h1>
    <canvas id="waveform" width="600" height="200"></canvas>
    <div class="controls">
        <button id="start">Start Audio</button>
        <button id="play">Play/Stop</button>
        <div class="slider-container">
            <label for="frequency">Frequency: <span id="freqValue">440</span> Hz</label>
            <input type="range" id="frequency" min="20" max="2000" value="440" step="1">
        </div>
        <div class="slider-container">
            <label for="amplitude">Amplitude: <span id="ampValue">0.5</span></label>
            <input type="range" id="amplitude" min="0" max="1" value="0.5" step="0.01">
        </div>
    </div>

    <script>
        // Create an oscillator
        const osc = new Tone.Oscillator(440, "sine").toDestination();
        let isPlaying = false;
        
        // Canvas setup
        const canvas = document.getElementById('waveform');
        const ctx = canvas.getContext('2d');
        
        // Animation variables
        let animationFrame;
        let phase = 0;
        const samplesPerSecond = 60; // Animation frame rate
        const samplesPerCycle = 100; // Number of points to draw per cycle
        
        function drawAnimatedWaveform() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            ctx.beginPath();
            ctx.strokeStyle = '#4CAF50';
            ctx.lineWidth = 2;
            
            const centerY = canvas.height / 2;
            const amplitude = canvas.height / 2 * 0.8;
            const frequency = osc.frequency.value;
            
            // Calculate the phase increment based on frequency
            const phaseIncrement = (frequency / samplesPerSecond) * 2 * Math.PI;
            
            for (let x = 0; x < canvas.width; x++) {
                const t = (x / canvas.width) * samplesPerCycle;
                const y = centerY + Math.sin(phase + t * 2 * Math.PI / samplesPerCycle) * amplitude;
                
                if (x === 0) {
                    ctx.moveTo(x, y);
                } else {
                    ctx.lineTo(x, y);
                }
            }
            
            ctx.stroke();
            
            // Update phase for next frame
            phase += phaseIncrement;
            if (phase >= 2 * Math.PI) {
                phase -= 2 * Math.PI;
            }
            
            // Continue animation if playing
            if (isPlaying) {
                animationFrame = requestAnimationFrame(drawAnimatedWaveform);
            }
        }
        
        // Start button functionality
        document.getElementById('start').addEventListener('click', async () => {
            await Tone.start();
            console.log('Audio is ready');
        });

        // Play/Stop button functionality
        document.getElementById('play').addEventListener('click', () => {
            if (isPlaying) {
                osc.stop();
                cancelAnimationFrame(animationFrame);
                isPlaying = false;
            } else {
                osc.start();
                isPlaying = true;
                drawAnimatedWaveform();
            }
        });

        // Frequency slider
        const frequencySlider = document.getElementById('frequency');
        const freqValue = document.getElementById('freqValue');
        
        frequencySlider.addEventListener('input', (e) => {
            const freq = e.target.value;
            freqValue.textContent = freq;
            osc.frequency.value = freq;
        });

        // Amplitude slider
        const amplitudeSlider = document.getElementById('amplitude');
        const ampValue = document.getElementById('ampValue');
        
        amplitudeSlider.addEventListener('input', (e) => {
            const amp = e.target.value;
            ampValue.textContent = amp;
            osc.volume.value = Tone.gainToDb(amp);
        });
    </script>
</body>
</html>
